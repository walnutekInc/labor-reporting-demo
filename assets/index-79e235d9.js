import{x as y,c as $,Q as x,C as D,b as k,k as T,w as g,e as t,g as u,f as d,R as E,J as V,B as A,d as B,E as I,K as S,L as q,F,t as M}from"./index-692e5e41.js";import{u as U,a as R,c as b,_ as v,D as L,b as N,S as _}from"./sweetalert2.all-823813ac.js";import{M as K}from"./Modal-afe60fd7.js";import{_ as z}from"./FormSelect-06a664ec.js";import"./plugin-vueexport-helper-c27b6911.js";import"./menu-64431b81.js";import"./default.cssvuetypestyleindex0srctruelang-a274447a.js";const j={class:"col-12 col-lg-6"},J={class:"col-12 col-lg-6"},O={class:"col-12 col-lg-6"},P={class:"col-12 col-lg-6"},Q={class:"btn-list text-center mt-5"},G=t("button",{class:"btn btn-md btn-primary",type:"submit"}," 確定 ",-1),H={__name:"FormModal",props:{reload:{type:Function,required:!0}},setup(w,{expose:f}){const r=w,c=y(!1),{handleSubmit:n,resetForm:h}=U({initialValues:{name:"",account:"",password:"",status:"ACTIVED"},validationSchema:$(()=>R().shape({name:b().required("姓名是必填的"),account:b().required("帳號是必填的"),password:b().test("notEdit","密碼是必填的",function(a){return c.value?!0:!x(a)})}))}),l=D(),i=y(null),m=(a=null)=>{c.value=a!==null,h({values:a?{...a,password:""}:{name:"",account:"",password:"",status:"ACTIVED"}}),i.value.show()},p=n(async a=>{console.log("Form submitted:",a),i.value.hide(),l.success("成功"),r.reload(),i.value.hide()});return f({show:m}),(a,s)=>(k(),T(K,{ref_key:"modalRef",ref:i,title:c.value?"編輯用戶":"新增用戶","dialog-class":"modal-dailog-centered","hide-footer":!0},{default:g(()=>[t("form",{class:"row",onSubmit:s[1]||(s[1]=(...e)=>u(p)&&u(p)(...e))},[t("div",j,[d(v,{name:"name",label:"姓名",required:""})]),t("div",J,[d(v,{name:"account",label:"帳號",required:""})]),t("div",O,[d(v,{name:"password",label:"密碼",required:!c.value},null,8,["required"])]),t("div",P,[d(z,{name:"status",label:"狀態","can-clear":!1,options:[{label:"啟用",value:"ACTIVED"},{label:"停用",value:"停用"}]})]),t("div",Q,[t("button",{class:"btn btn-md btn-outline-primary",type:"button",onClick:s[0]||(s[0]=e=>i.value.hide())}," 取消 "),G])],32)]),_:1},8,["title"]))}},W={class:"row row-sm"},X={class:"col-sm-12 col-md-12 col-lg-12 col-xl-12 grid-margin"},Y={class:"card custom-card"},Z={class:"card-header border-bottom-0 pb-0"},tt={class:"row"},et={class:"col-12"},st={class:"d-flex flex-column flex-lg-row justify-content-between"},ot={class:"input-group wd-lg-25p"},at={class:"input-group-append"},nt={class:"card-body"},lt={class:"form-check form-switch"},rt=["id","checked","onChange"],ct=["for"],it={class:"d-flex"},dt=["onClick"],ut=["onClick"],mt="帳號管理",gt={__name:"index",setup(w){const{getUserList:f,pagination:r,userList:c}=E(),n=V({keyword:"",sort:"desc",orderBy:"createDate"});A(()=>{l(1)});const h=[{key:"name",label:"姓名",sort:!0},{key:"account",label:"帳號"},{key:"status",label:"狀態"},{key:"action",label:"Action"}],l=async(s=1,e=10)=>{let o={page:s,limit:e,...n};await f(o)},i=(s="createTime",e="desc")=>{n.orderBy=s,n.sort=e,l(1,r.value.size)},m=y(null),p=s=>{_.fire({title:"Are you sure?",text:`刪除 User「${s.name}」？`,type:"warning",showCancelButton:!0,confirmButtonText:"是的，確定刪除"}).then(async e=>{e.value&&(await l(c.value.length==1?1:r.value.current),_.fire("This Deleted!",`刪除 User「${s.name}」！`,"success"))})},a=async s=>{try{const e=s.status==="ACTIVED"?"UNACTIVED":"ACTIVED";s.status=e,_.fire({title:"狀態更新成功",text:`用户 "${s.name}" 的狀態已更改為 ${e==="ACTIVED"?"啟用":"停用"}`,icon:"success",confirmButtonText:"確定"})}catch(e){console.error("更新用户状态失败:",e),_.fire({title:"更新失敗",text:"無法更新用户狀態，請稍後再試。",icon:"error",confirmButtonText:"確定"}),s.status=s.status==="ACTIVED"?"UNACTIVED":"ACTIVED"}};return(s,e)=>(k(),B(F,null,[d(N,{title:mt}),t("div",W,[t("div",X,[t("div",Y,[t("div",Z,[t("div",tt,[t("div",et,[t("div",st,[t("div",ot,[I(t("input",{type:"text",class:"form-control",placeholder:"搜尋","onUpdate:modelValue":e[0]||(e[0]=o=>n.keyword=o),onKeyup:e[1]||(e[1]=q(o=>l(1),["enter"]))},null,544),[[S,n.keyword]]),t("span",at,[t("button",{class:"btn btn-primary",type:"button",onClick:e[2]||(e[2]=o=>l(1))}," 搜尋 ")])]),t("button",{class:"btn btn-primary mt-2 mt-lg-0",onClick:e[3]||(e[3]=o=>m.value.show())},"新增帳號")])])])]),t("div",nt,[d(L,{header:h,items:u(c),onChangePage:l,onOrderChange:i,pagination:u(r),orderBy:n.orderBy,sort:n.sort},{status:g(({item:o})=>[t("div",lt,[t("input",{class:"form-check-input",type:"checkbox",id:`statusSwitch_${o.account}`,checked:o.status==="ACTIVED",onChange:C=>a(o)},null,40,rt),t("label",{class:"form-check-label",for:`statusSwitch_${o.account}`},M(o.status==="ACTIVED"?"啟用":"停用"),9,ct)])]),action:g(({item:o})=>[t("div",it,[t("button",{class:"btn btn-sm btn-danger me-2",type:"button",onClick:C=>p(o)},"刪除",8,dt),t("button",{class:"btn btn-sm btn-info me-2",type:"button",onClick:C=>m.value.show(o)},"修改",8,ut)])]),_:1},8,["items","pagination","orderBy","sort"])])])]),d(H,{ref_key:"formModalRef",ref:m,reload:()=>l(u(r).current,u(r).size)},null,8,["reload"])])],64))}};export{gt as default};
